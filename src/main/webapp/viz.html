<lift:surround with="default" at="content">
<head>
  <script id="jquery" src="/classpath/jquery.js" type="text/javascript"/>
</head>
  <h2>Map of the documents</h2>
  <div id="viz">
    <div id="vizdata">
      <div id="vizmap"></div>
      <div id="vizvariances"></div>
    </div>
    <lift:Visualization.drawMap></lift:Visualization.drawMap>
    <lift:Visualization.drawVariances></lift:Visualization.drawVariances>
    <lift:Visualization.renderData></lift:Visualization.renderData>
    <script type="text/javascript">
// <![CDATA[
      var loadDocument = function(event, pos, item) {
        if (item) {
          jQuery.getJSON('api/text/' + textIds[item.seriesIndex] + '/' + item.dataIndex + '.json', function(data) {
            jQuery('#drilldown-title').text(data.text.title + ' (' + data.document.seq + ')');
            jQuery('#drilldown-author').text(data.text.author + ' (' + data.text.year + ')');
            jQuery('#drilldown-text').html(data.document.html);
          });
        }
      };

      var bindHover = function() {
        jQuery("#vizmap").bind("plothover", function (event, pos, item) {
          if (item) {
            loadDocument(event, pos, item);
            jQuery('#vizmap').unbind();
            setTimeout(bindBoth, 500);
          }
        });
      }

      var bindClick = function() {
        jQuery("#vizmap").bind("plotclick", function (event, pos, item) {
          if (item) {
            loadDocument(event, pos, item);
            jQuery('#vizmap').unbind();
            setTimeout(bindBoth, 3000);
          }
        });
      };

      var bindBoth = function() {
        bindHover();
        bindClick();
      };

      bindBoth();
// ]]>
    </script>
    <div id="drilldown">
      <h3 id="drilldown-title"></h3>
      <h4 id="drilldown-author"></h4>
      <div id="drilldown-text"></div>
    </div>
  </div>
</lift:surround>

